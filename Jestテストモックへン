å®Ÿè£…ãƒ¢ãƒƒã‚¯ç‰¹åŒ–ã§æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ã«è§£èª¬ã—ã¾ã™ï¼å®Ÿéš›ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ™‚ã«ä½¿ãˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¸­å¿ƒã«èª¬æ˜ã—ã¾ã™ã­ã€‚

## ğŸ¯ **ãƒ¢ãƒƒã‚¯ã¨ã¯ä½•ã‹ï¼Ÿï¼ˆ3ç§’ã§ç†è§£ï¼‰**

```javascript
// âŒ å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ï¼ˆãƒ†ã‚¹ãƒˆã§å›°ã‚‹ï¼‰
const result = await fetch('/api/insurance-rate')

// âœ… ãƒ¢ãƒƒã‚¯ï¼ˆå½ç‰©ã®APIï¼‰
const mockFetch = jest.fn().mockResolvedValue({ rate: 1000 })
```

**ãƒ¢ãƒƒã‚¯ = å½ç‰©ã ã‘ã©ã€ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªæœ€ä½é™ã®æ©Ÿèƒ½ã‚’æŒã¤ã‚‚ã®**

---

## ğŸ› ï¸ **åŸºæœ¬çš„ãªãƒ¢ãƒƒã‚¯å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**

### **Pattern 1: å˜ç´”ãªé–¢æ•°ãƒ¢ãƒƒã‚¯**

```javascript
// âŒ åˆå¿ƒè€…ãŒã‚„ã‚ŠãŒã¡ãªé–“é•ã„
const wrapper = mount(Component)
wrapper.vm.calcAmount() // å®Ÿéš›ã®è¨ˆç®—ãŒå®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã†

// âœ… æ­£ã—ã„ãƒ¢ãƒƒã‚¯å®Ÿè£…
const wrapper = mount(Component)
wrapper.vm.calcAmount = jest.fn() // ãƒ¢ãƒƒã‚¯åŒ–
wrapper.vm.calcAmount() // å®Ÿè¡Œã•ã‚Œã‚‹ãŒã€å®Ÿéš›ã®å‡¦ç†ã¯ã—ãªã„

// æ¤œè¨¼
expect(wrapper.vm.calcAmount).toHaveBeenCalled() // å‘¼ã°ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
```

### **Pattern 2: æˆ»ã‚Šå€¤ä»˜ããƒ¢ãƒƒã‚¯**

```javascript
// å®Ÿè£…ä¾‹ï¼šä¿é™ºæ–™è¨ˆç®—ã®ãƒ¢ãƒƒã‚¯
describe('ä¿é™ºæ–™è¨ˆç®—ãƒ†ã‚¹ãƒˆ', () => {
  it('ãƒ—ãƒ©ãƒ³å¤‰æ›´æ™‚ã«ä¿é™ºæ–™ãŒæ›´æ–°ã•ã‚Œã‚‹', async () => {
    const wrapper = mount(ProductDetailSumameRabbit, {
      propsData: { /* ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ */ }
    })
    
    // âœ… è¨ˆç®—ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ã¦æˆ»ã‚Šå€¤ã‚’å›ºå®š
    wrapper.vm.calcAmount = jest.fn().mockReturnValue(1500)
    
    // ãƒ—ãƒ©ãƒ³å¤‰æ›´ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    wrapper.find('select[name="product_09_01"]').setValue('3')
    await wrapper.vm.$nextTick()
    
    // ãƒ¢ãƒƒã‚¯ãŒå‘¼ã°ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    expect(wrapper.vm.calcAmount).toHaveBeenCalled()
  })
})
```

---

## ğŸ—ƒï¸ **Vuexã‚¹ãƒˆã‚¢ã®ãƒ¢ãƒƒã‚¯ï¼ˆè¶…é‡è¦ï¼‰**

### **Pattern 3: ã‚¹ãƒˆã‚¢ãƒ¢ãƒƒã‚¯ã®åŸºæœ¬**

```javascript
// âŒ å®Ÿéš›ã®Vuexã‚¹ãƒˆã‚¢ã‚’ä½¿ã†ï¼ˆè¤‡é›‘ã§å£Šã‚Œã‚„ã™ã„ï¼‰
import store from '@/store'
const wrapper = mount(Component, { store })

// âœ… ãƒ¢ãƒƒã‚¯ã‚¹ãƒˆã‚¢ã‚’ä½¿ã†ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§å®‰å®šï¼‰
const mockStore = {
  getters: {
    'user/isLoggedIn': jest.fn().mockReturnValue(true),
    'simulation/situation': jest.fn().mockReturnValue({
      sumameRabbit: {
        plan: 3,
        payMethodTimesCode: "01"
      }
    })
  },
  dispatch: jest.fn(),
  commit: jest.fn()
}

const wrapper = mount(Component, {
  mocks: { $store: mockStore }
})
```

### **Pattern 4: getters ã®å‹•çš„å¤‰æ›´**

```javascript
it('ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã‚ˆã£ã¦è¡¨ç¤ºãŒå¤‰ã‚ã‚‹', async () => {
  const mockStore = {
    getters: {
      'user/isLoggedIn': jest.fn()
    }
  }
  
  const wrapper = mount(Component, {
    mocks: { $store: mockStore }
  })
  
  // âœ… ãƒ†ã‚¹ãƒˆé€”ä¸­ã§getterã®æˆ»ã‚Šå€¤ã‚’å¤‰æ›´
  mockStore.getters['user/isLoggedIn'].mockReturnValue(true)
  await wrapper.vm.$nextTick()
  expect(wrapper.find('.login-info').exists()).toBe(true)
  
  mockStore.getters['user/isLoggedIn'].mockReturnValue(false)
  await wrapper.vm.$nextTick()
  expect(wrapper.find('.login-info').exists()).toBe(false)
})
```

---

## ğŸ“… **æ—¥ä»˜ãƒ»æ™‚é–“ã®ãƒ¢ãƒƒã‚¯ï¼ˆå®Ÿç”¨çš„ï¼‰**

### **Pattern 5: æ—¥ä»˜å›ºå®šãƒ‘ã‚¿ãƒ¼ãƒ³**

```javascript
describe('å¹´é½¢åˆ¶é™ãƒ†ã‚¹ãƒˆ', () => {
  let mockDate
  
  beforeEach(() => {
    // âœ… æ—¥ä»˜ã‚’2019/10/1ã«å›ºå®š
    const fixedDate = new Date(2019, 9, 1) // 10æœˆã¯9ï¼ˆ0ãƒ™ãƒ¼ã‚¹ï¼‰
    mockDate = jest.spyOn(global, 'Date').mockImplementation(() => fixedDate)
  })
  
  afterEach(() => {
    // âœ… å¿…ãšã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    mockDate.mockRestore()
  })
  
  it('20æ­³ã®å ´åˆã€å…¨ã¦ã®ç‰¹ç´„ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    const application = {
      birthDate: '1999-1-1', // 20æ­³
      fullAge: 20
    }
    
    const wrapper = mount(ProductDetailSumameRabbit, {
      propsData: { application }
    })
    
    expect(wrapper.find('select[name="product_09_07"]').exists()).toBe(true)
  })
})
```

### **Pattern 6: æ™‚é–“ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ãƒ¢ãƒƒã‚¯**

```javascript
// å®Ÿè£…ä¾‹ï¼šæ™‚é–“çµŒéã®ãƒ†ã‚¹ãƒˆ
it('5ç§’å¾Œã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async () => {
  jest.useFakeTimers() // âœ… å½ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨
  
  const wrapper = mount(TimeoutComponent)
  
  // 5ç§’é€²ã‚ã‚‹
  jest.advanceTimersByTime(5000)
  await wrapper.vm.$nextTick()
  
  expect(wrapper.find('.timeout-message').exists()).toBe(true)
  
  jest.useRealTimers() // âœ… å…ƒã«æˆ»ã™
})
```

---

## ğŸŒ **DOMè¦ç´ ã®ãƒ¢ãƒƒã‚¯**

### **Pattern 7: getElementById ã®ãƒ¢ãƒƒã‚¯**

```javascript
describe('ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³æ©Ÿèƒ½', () => {
  beforeEach(() => {
    // âœ… DOMè¦ç´ ã‚’å½ç‰©ã§ç”¨æ„
    const mockElements = {
      sumameRabbitAccordionTarget: {
        style: { height: '0px' }
      },
      sumameRabbitAccordionBody: {
        clientHeight: 150
      }
    }
    
    // document.getElementById ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    jest.spyOn(document, 'getElementById')
        .mockImplementation((id) => mockElements[id])
  })
  
  it('ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é«˜ã•ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹', () => {
    const wrapper = mount(ProductDetailSumameRabbit)
    wrapper.vm.adjustAccordionHeight()
    
    // ãƒ¢ãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ã®é«˜ã•ãŒå¤‰æ›´ã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
    const target = document.getElementById('sumameRabbitAccordionTarget')
    expect(target.style.height).toBe('150px')
  })
})
```

---

## ğŸ”„ **APIå‘¼ã³å‡ºã—ã®ãƒ¢ãƒƒã‚¯**

### **Pattern 8: éåŒæœŸå‡¦ç†ã®ãƒ¢ãƒƒã‚¯**

```javascript
// âœ… APIå‘¼ã³å‡ºã—ã‚’ãƒ¢ãƒƒã‚¯åŒ–
global.fetch = jest.fn()

describe('ä¿é™ºæ–™APIå‘¼ã³å‡ºã—', () => {
  beforeEach(() => {
    fetch.mockClear() // å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’é™¤å»
  })
  
  it('æ­£å¸¸ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆ', async () => {
    // âœ… æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ¢ãƒƒã‚¯
    fetch.mockResolvedValueOnce({
      ok: true,
      json: async () => ({ premium: 1500 })
    })
    
    const wrapper = mount(Component)
    await wrapper.vm.fetchPremium()
    
    expect(fetch).toHaveBeenCalledWith('/api/premium', expect.any(Object))
    expect(wrapper.vm.premium).toBe(1500)
  })
  
  it('ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆ', async () => {
    // âœ… ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ¢ãƒƒã‚¯
    fetch.mockRejectedValueOnce(new Error('API Error'))
    
    const wrapper = mount(Component)
    await wrapper.vm.fetchPremium()
    
    expect(wrapper.find('.error-message').exists()).toBe(true)
  })
})
```

---

## ğŸ¨ **Vue.jsç‰¹æœ‰ã®ãƒ¢ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³**

### **Pattern 9: å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¢ãƒƒã‚¯**

```javascript
// âœ… é‡ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯åŒ–
const MockModal = {
  name: 'Modal',
  template: '<div class="mock-modal"><slot /></div>',
  props: ['visible'],
  methods: {
    close: jest.fn()
  }
}

describe('ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆ', () => {
  it('ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã', async () => {
    const wrapper = mount(ProductDetailSumameRabbit, {
      components: {
        Modal: MockModal // âœ… å®Ÿéš›ã®Modalã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç½®ãæ›ãˆ
      }
    })
    
    await wrapper.find('.qa71').trigger('click')
    await wrapper.vm.$nextTick()
    
    expect(wrapper.find('.mock-modal').exists()).toBe(true)
  })
})
```

### **Pattern 10: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ¢ãƒƒã‚¯**

```javascript
it('ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ãæ¸¡ã•ã‚Œã‚‹', () => {
  // âœ… ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æº–å‚™
  const mockProps = {
    application: {
      fullAge: 25,
      gender: 2,
      insuranceRates: [
        { insuranceCd: '206', amount60: 1000 }
      ]
    },
    constants: {
      NO_DIVIDEND_DISPLAY_PRICE: 50000
    },
    applicationValues: {
      sumameRabbit: 0
    }
  }
  
  const wrapper = mount(ProductDetailSumameRabbit, {
    propsData: mockProps
  })
  
  expect(wrapper.vm.application.fullAge).toBe(25)
})
```

---

## ğŸ” **ãƒ¢ãƒƒã‚¯æ¤œè¨¼ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

### **Pattern 11: å‘¼ã³å‡ºã—å›æ•°ã®æ¤œè¨¼**

```javascript
it('ãƒ—ãƒ©ãƒ³å¤‰æ›´æ™‚ã«è¨ˆç®—ãŒ1å›ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹', async () => {
  const wrapper = mount(Component)
  const calcSpy = jest.spyOn(wrapper.vm, 'calcAmount')
  
  // ãƒ—ãƒ©ãƒ³ã‚’å¤‰æ›´
  await wrapper.find('select').setValue('3')
  
  // âœ… 1å›ã ã‘å‘¼ã°ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  expect(calcSpy).toHaveBeenCalledTimes(1)
  
  calcSpy.mockRestore()
})
```

### **Pattern 12: å¼•æ•°ã®æ¤œè¨¼**

```javascript
it('æ­£ã—ã„å¼•æ•°ã§ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚Œã‚‹', () => {
  const wrapper = mount(Component)
  const mockMethod = jest.fn()
  wrapper.vm.updateOption = mockMethod
  
  wrapper.vm.changePolicy('cancer', 1000)
  
  // âœ… å¼•æ•°ãŒæ­£ã—ã„ã‹ãƒã‚§ãƒƒã‚¯
  expect(mockMethod).toHaveBeenCalledWith('cancer', 1000)
})
```

---

## ğŸš€ **å®Ÿè·µçš„ãªãƒ¢ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**

### **å®Œå…¨ãªãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹**

```javascript
import { mount } from '@vue/test-utils'
import ProductDetail from '@/components/ProductDetail.vue'

describe('ProductDetail.vue', () => {
  let wrapper
  let mockProps
  
  // âœ… å…±é€šã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  beforeEach(() => {
    // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ¢ãƒƒã‚¯
    mockProps = {
      application: {
        fullAge: 30,
        gender: 2,
        insuranceRates: []
      }
    }
    
    // DOMè¦ç´ ã®ãƒ¢ãƒƒã‚¯
    const mockElements = {
      accordionTarget: { style: { height: '0px' } },
      accordionBody: { clientHeight: 100 }
    }
    jest.spyOn(document, 'getElementById')
        .mockImplementation(id => mockElements[id])
    
    // æ—¥ä»˜ã®ãƒ¢ãƒƒã‚¯
    jest.spyOn(Date, 'now').mockReturnValue(1577836800000) // 2020/1/1
  })
  
  // âœ… å„ãƒ†ã‚¹ãƒˆå¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  afterEach(() => {
    if (wrapper) {
      wrapper.destroy()
    }
    jest.restoreAllMocks()
  })
  
  it('åŸºæœ¬çš„ãªè¡¨ç¤ºãƒ†ã‚¹ãƒˆ', () => {
    wrapper = mount(ProductDetail, {
      propsData: mockProps
    })
    
    expect(wrapper.find('.main-contract').text()).toBe('åŸºæœ¬ä¿éšœ')
  })
  
  it('ãƒ—ãƒ©ãƒ³å¤‰æ›´ãƒ†ã‚¹ãƒˆ', async () => {
    wrapper = mount(ProductDetail, {
      propsData: mockProps
    })
    
    // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    const calcSpy = jest.spyOn(wrapper.vm, 'calcAmount')
    
    await wrapper.find('select').setValue('3')
    await wrapper.vm.$nextTick()
    
    expect(calcSpy).toHaveBeenCalled()
  })
})
```

---

## ğŸ“ **ãƒ¢ãƒƒã‚¯å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

### **âœ… ã‚„ã‚‹ã¹ãã“ã¨**
- [ ] å¤–éƒ¨ä¾å­˜ï¼ˆAPIã€DOMï¼‰ã¯å¿…ãšãƒ¢ãƒƒã‚¯åŒ–
- [ ] å„ãƒ†ã‚¹ãƒˆå¾Œã«ãƒ¢ãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢
- [ ] å…·ä½“çš„ãªæˆ»ã‚Šå€¤ã‚’è¨­å®š
- [ ] ãƒ¡ã‚½ãƒƒãƒ‰ã®å‘¼ã³å‡ºã—ã‚’æ¤œè¨¼

### **âŒ ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨**
- [ ] å®Ÿéš›ã®APIã‚’å‘¼ã³å‡ºã™
- [ ] ãƒ¢ãƒƒã‚¯ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å¿˜ã‚Œã‚‹  
- [ ] è¤‡é›‘ãªãƒ¢ãƒƒã‚¯ã‚’ä½œã‚Šã™ãã‚‹
- [ ] ãƒ¢ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã‚’æ›–æ˜§ã«ã™ã‚‹

### **ğŸ¯ ãƒ¢ãƒƒã‚¯å®Ÿè£…ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³**

```javascript
// âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„
const mockStore = { getters: jest.fn() }

// âœ… ç›®çš„ãŒæ˜ç¢º
const calcSpy = jest.spyOn(wrapper.vm, 'calcAmount')

// âœ… ç¢ºå®Ÿã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
afterEach(() => jest.restoreAllMocks())
```

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦šãˆã‚Œã°ã€ã©ã‚“ãªè¤‡é›‘ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚ãƒ†ã‚¹ãƒˆãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
